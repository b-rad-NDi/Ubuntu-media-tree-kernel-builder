From b089d4d737fe2103de25083f9537215e9b7d781e Mon Sep 17 00:00:00 2001
From: Brad Love <hidden@email.co>
Date: Tue, 20 Jan 2026 18:51:44 -0600
Subject: [PATCH 6/6] Packaging updates

---
 .../control.d/flavour-control.stub            |  4 ++--
 debian.hwe-5.15/control.stub.in               |  3 ++-
 debian.hwe-5.15/copyright                     | 22 +++++++++++++++++++
 debian.hwe-5.15/dkms-versions                 |  1 -
 debian.hwe-5.15/rules.d/amd64.mk              |  6 ++---
 debian.hwe-5.15/rules.d/arm64.mk              |  2 +-
 debian.hwe-5.15/rules.d/ppc64el.mk            |  2 +-
 debian.hwe-5.15/rules.d/s390x.mk              |  2 +-
 debian.hwe-5.15/rules.d/x32.mk                |  2 +-
 debian/control.d/flavour-buildinfo.stub       |  2 +-
 debian/rules                                  |  2 +-
 debian/rules.d/0-common-vars.mk               | 17 ++++++++++----
 debian/scripts/config-check                   |  2 +-
 13 files changed, 49 insertions(+), 18 deletions(-)

diff --git a/debian.hwe-5.15/control.d/flavour-control.stub b/debian.hwe-5.15/control.d/flavour-control.stub
index 5f0bde3034d4..f4c02d40e94d 100644
--- a/debian.hwe-5.15/control.d/flavour-control.stub
+++ b/debian.hwe-5.15/control.d/flavour-control.stub
@@ -31,8 +31,8 @@ Depends: ${misc:Depends}, ${shlibs:Depends}, kmod, linux-base (>= 4.5ubuntu1~16.
 Recommends: BOOTLOADER, initramfs-tools | linux-initramfs-tool
 Breaks: flash-kernel (<< 3.90ubuntu2) [arm64 armhf], s390-tools (<< 2.3.0-0ubuntu3) [s390x]
 Conflicts: linux-image=SIGN-PEER-PKG=-PKGVER-ABINUM-FLAVOUR
-Suggests: fdutils, linux-doc | SRCPKGNAME-source-PKGVER, SRCPKGNAME-tools, linux-headers-PKGVER-ABINUM-FLAVOUR, linux-modules-extra-PKGVER-ABINUM-FLAVOUR
-Description: Linux kernel image for version PKGVER on DESC
+Suggests: fdutils, SRCPKGNAME-tools, linux-headers-PKGVER-ABINUM-FLAVOUR, linux-modules-extra-PKGVER-ABINUM-FLAVOUR
+Description: Linux kernel image with slipstreamed mediatree drivers for version PKGVER on DESC
  This package contains the=SIGN-ME-TXT= Linux kernel image for version PKGVER on
  DESC.
  .
diff --git a/debian.hwe-5.15/control.stub.in b/debian.hwe-5.15/control.stub.in
index 378444cff106..7414d96733b1 100644
--- a/debian.hwe-5.15/control.stub.in
+++ b/debian.hwe-5.15/control.stub.in
@@ -1,7 +1,8 @@
 Source: SRCPKGNAME
 Section: devel
 Priority: optional
-Maintainer: Ubuntu Kernel Team <kernel-team@lists.ubuntu.com>
+Maintainer: Fake User <hidden@email.co>
+XSBC-Original-Maintainer: Ubuntu Kernel Team <kernel-team@lists.ubuntu.com>
 Standards-Version: 3.9.4.0
 Build-Depends:
  debhelper-compat (= 10),
diff --git a/debian.hwe-5.15/copyright b/debian.hwe-5.15/copyright
index d1d04a6d6697..b6f183f12da6 100644
--- a/debian.hwe-5.15/copyright
+++ b/debian.hwe-5.15/copyright
@@ -1,3 +1,25 @@
+#############################################################
+#############################################################
+#############################################################
+
+This is a patched version of the Ubuntu kernel.
+The latest media tree drivers from https://linuxtv.org are slip streamed in.
+
+Additional patches for hardware/performance/etc are also included.
+
+All patches are available at https://github.com/b-rad-NDi/Ubuntu-media-tree-kernel-builder
+
+The packaging and build system is spoonsored by Hauppauge Computer Works.
+
+    http://www.hauppauge.com
+
+Errors in packaging or building should be directed to github above.
+Bugs in the kernel or media tree drivers should be reported upstream.
+
+#############################################################
+#############################################################
+#############################################################
+
 This is the Ubuntu prepackaged version of the Linux kernel.
 Linux was written by Linus Torvalds <Linus.Torvalds@cs.Helsinki.FI>
 and others.
diff --git a/debian.hwe-5.15/dkms-versions b/debian.hwe-5.15/dkms-versions
index da8d76d3311d..6e84d070ddd7 100644
--- a/debian.hwe-5.15/dkms-versions
+++ b/debian.hwe-5.15/dkms-versions
@@ -1,3 +1,2 @@
 zfs-linux 2.1.5-1ubuntu6~22.04.5 modulename=zfs debpath=pool/universe/z/%package%/zfs-dkms_%version%_all.deb arch=amd64 arch=arm64 arch=ppc64el arch=s390x rprovides=spl-modules rprovides=spl-dkms rprovides=zfs-modules rprovides=zfs-dkms
 backport-iwlwifi-dkms 11510-0ubuntu1~22.04.3 modulename=iwlwifi debpath=pool/universe/b/%package%/backport-iwlwifi-dkms_%version%_all.deb arch=amd64 rprovides=iwlwifi-modules rprovides=backport-iwlwifi-dkms type=standalone
-v4l2loopback 0.12.7-2ubuntu2~22.04.1 modulename=v4l2loopback debpath=pool/universe/v/%package%/v4l2loopback-dkms_%version%_all.deb arch=amd64 rprovides=v4l2loopback-modules rprovides=v4l2loopback-dkms
diff --git a/debian.hwe-5.15/rules.d/amd64.mk b/debian.hwe-5.15/rules.d/amd64.mk
index d0384f0227a4..df23d1a64aba 100644
--- a/debian.hwe-5.15/rules.d/amd64.mk
+++ b/debian.hwe-5.15/rules.d/amd64.mk
@@ -8,7 +8,7 @@ kernel_file	= arch/$(build_arch)/boot/bzImage
 install_file	= vmlinuz
 vdso		= vdso_install
 no_dumpfile	= true
-uefi_signed     = true
+uefi_signed     = false
 do_tools_usbip  = true
 do_tools_cpupower = true
 do_tools_perf   = true
@@ -16,8 +16,8 @@ do_tools_perf_jvmti = true
 do_tools_bpftool = true
 do_tools_x86	= true
 do_tools_hyperv	= true
-do_tools_host = true
+do_tools_host = false
 do_extras_package = true
-do_tools_common = true
+do_tools_common = false
 do_tools_acpidbg = true
 do_odm_drivers  = true
diff --git a/debian.hwe-5.15/rules.d/arm64.mk b/debian.hwe-5.15/rules.d/arm64.mk
index d215e1bda1fe..139eacca89b3 100644
--- a/debian.hwe-5.15/rules.d/arm64.mk
+++ b/debian.hwe-5.15/rules.d/arm64.mk
@@ -7,7 +7,7 @@ build_image	= Image.gz
 kernel_file	= arch/$(build_arch)/boot/Image.gz
 install_file	= vmlinuz
 no_dumpfile = true
-uefi_signed     = true
+uefi_signed     = false
 
 vdso		= vdso_install
 
diff --git a/debian.hwe-5.15/rules.d/ppc64el.mk b/debian.hwe-5.15/rules.d/ppc64el.mk
index b205a5153b51..786e7beae016 100644
--- a/debian.hwe-5.15/rules.d/ppc64el.mk
+++ b/debian.hwe-5.15/rules.d/ppc64el.mk
@@ -8,7 +8,7 @@ kernel_file     = arch/powerpc/boot/vmlinux.strip
 install_file	= vmlinux
 no_dumpfile	= true
 do_extras_package = true
-opal_signed       = true
+opal_signed       = false
 do_tools_usbip    = true
 do_tools_cpupower = true
 do_tools_perf	  = true
diff --git a/debian.hwe-5.15/rules.d/s390x.mk b/debian.hwe-5.15/rules.d/s390x.mk
index 0620c638a724..4569e6e94a2e 100644
--- a/debian.hwe-5.15/rules.d/s390x.mk
+++ b/debian.hwe-5.15/rules.d/s390x.mk
@@ -11,7 +11,7 @@ vdso		= vdso_install
 no_dumpfile	= true
 
 do_extras_package = true
-sipl_signed       = true
+sipl_signed       = false
 do_tools_usbip    = true
 do_tools_cpupower = true
 do_tools_perf     = true
diff --git a/debian.hwe-5.15/rules.d/x32.mk b/debian.hwe-5.15/rules.d/x32.mk
index 84918880e252..e4bc4a3f1b0a 100644
--- a/debian.hwe-5.15/rules.d/x32.mk
+++ b/debian.hwe-5.15/rules.d/x32.mk
@@ -8,6 +8,6 @@ kernel_file	= arch/$(build_arch)/boot/bzImage
 install_file	= vmlinuz
 vdso		= vdso_install
 no_dumpfile	= true
-uefi_signed     = true
+uefi_signed     = false
 
 do_flavour_image_package = false
diff --git a/debian/control.d/flavour-buildinfo.stub b/debian/control.d/flavour-buildinfo.stub
index dd08a6715f6b..68df67c02a29 100644
--- a/debian/control.d/flavour-buildinfo.stub
+++ b/debian/control.d/flavour-buildinfo.stub
@@ -1,5 +1,5 @@
 
-Package: linux-buildinfo-PKGVER-ABINUM-FLAVOUR
+Package: linux-buildinfo-mediatree-PKGVER-ABINUM-FLAVOUR
 Build-Profiles: <!stage1>
 Architecture: ARCH
 Section: kernel
diff --git a/debian/rules b/debian/rules
index 3132d26cfc7b..cf3cfec5264a 100755
--- a/debian/rules
+++ b/debian/rules
@@ -35,7 +35,7 @@ include $(DROOT)/rules.d/1-maintainer.mk
 
 do_linux_tools=$(sort $(filter-out false,$(do_tools_usbip) $(do_tools_cpupower) $(do_tools_perf) $(do_tools_bpftool) $(do_tools_x86)))
 do_cloud_tools=$(sort $(filter-out false,$(do_tools_hyperv)))
-do_tools_common?=true
+do_tools_common?=false
 do_tools_host?=false
 do_tools_perf_jvmti?=false
 do_enforce_all?=false
diff --git a/debian/rules.d/0-common-vars.mk b/debian/rules.d/0-common-vars.mk
index 5d3982f87462..c506f74cc5ca 100644
--- a/debian/rules.d/0-common-vars.mk
+++ b/debian/rules.d/0-common-vars.mk
@@ -43,6 +43,15 @@ family=ubuntu
 # or configs.
 AUTOBUILD=
 
+skipabi         ?= true
+skipmodule      ?= true
+skipdbg         ?= true
+do_binary_udebs ?= false
+do_tools_common ?= false
+do_tools	?= true
+do_linux_tools	?= false
+skipretpoline	?= true
+
 ifneq ($(AUTOBUILD),)
 skipabi		= true
 skipmodule	= true
@@ -143,7 +152,7 @@ bin_pkg_name_signed=linux-image-$(abi_release)
 bin_pkg_name_unsigned=linux-image-unsigned-$(abi_release)
 mods_pkg_name=linux-modules-$(abi_release)
 mods_extra_pkg_name=linux-modules-extra-$(abi_release)
-bldinfo_pkg_name=linux-buildinfo-$(abi_release)
+bldinfo_pkg_name=linux-buildinfo-mediatree-$(abi_release)
 hdrs_pkg_name=linux-headers-$(abi_release)
 indep_hdrs_pkg_name=$(src_pkg_name)-headers-$(abi_release)
 
@@ -154,7 +163,7 @@ indep_hdrs_pkg_name=$(src_pkg_name)-headers-$(abi_release)
 # failures get sorted out. Finally, the doc package doesn't really need to be built
 # for developer testing (its kind of slow), so only do it if on a buildd.
 ifneq ($(filter --,$(variants)),)
-do_doc_package=true
+do_doc_package=false
 else
 do_doc_package=false
 endif
@@ -168,7 +177,7 @@ doc_pkg_name=$(src_pkg_name)-doc
 # Similarly with the linux-source package, you need not build it as a developer. Its
 # somewhat I/O intensive and utterly useless.
 #
-do_source_package=true
+do_source_package=false
 do_source_package_content=true
 ifeq ($(full_build),false)
 do_source_package_content=false
@@ -177,7 +186,7 @@ endif
 # linux-libc-dev may not be needed, default to building it only for the
 # primary variant
 ifneq ($(filter --,$(variants)),)
-do_libc_dev_package=true
+do_libc_dev_package=false
 else
 do_libc_dev_package=false
 endif
diff --git a/debian/scripts/config-check b/debian/scripts/config-check
index 6e64277da00b..baef5cd9876a 100755
--- a/debian/scripts/config-check
+++ b/debian/scripts/config-check
@@ -22,7 +22,7 @@ my %values = ();
 # If we are in overridden then still perform the checks and emit the messages
 # but do not return failure.  Those items marked FATAL will alway trigger
 # failure.
-my $fail_exit = 1;
+my $fail_exit = 0;
 $fail_exit = 0 if ($warn_only eq 'true' || $warn_only eq '1');
 my $exit_val = 0;
 
-- 
2.25.1

